
CREATE TABLE IF NOT EXISTS USERS
(
    USER_ID  BIGINT      NOT NULL AUTO_INCREMENT,
    EMAIL    VARCHAR(50) NOT NULL,
    LOGIN    VARCHAR(50) NOT NULL,
    NAME     VARCHAR(50) NOT NULL,
    BIRTHDAY DATE,
    CONSTRAINT USERS_PK PRIMARY KEY (USER_ID),
    CONSTRAINT USERS_UNIQUE_EMAIL UNIQUE (EMAIL),
    CONSTRAINT USERS_UNIQUE_LOGIN UNIQUE (LOGIN)
);

CREATE TABLE IF NOT EXISTS FRIENDS
(
    USER_ID   BIGINT REFERENCES USERS (USER_ID) ON DELETE CASCADE ON UPDATE RESTRICT,
    FRIEND_ID BIGINT REFERENCES USERS (USER_ID) ON DELETE CASCADE ON UPDATE RESTRICT,
    CONSTRAINT FRIENDS_PK PRIMARY KEY (USER_ID, FRIEND_ID)
);



CREATE TABLE IF NOT EXISTS RATINGS
(
    RATING_ID BIGINT      NOT NULL AUTO_INCREMENT,
    NAME      VARCHAR(50) NOT NULL,
    CONSTRAINT RATINGS_PK PRIMARY KEY (RATING_ID)
);

CREATE TABLE IF NOT EXISTS FILMS
(
    FILM_ID      BIGINT      NOT NULL AUTO_INCREMENT,
    NAME         VARCHAR(50) NOT NULL,
    DESCRIPTION  VARCHAR(200),
    RELEASE_DATE DATE,
    DURATION     BIGINT,
    RATING_ID    BIGINT REFERENCES RATINGS (RATING_ID) ON DELETE RESTRICT ON UPDATE RESTRICT,
    CONSTRAINT FILMS_PK PRIMARY KEY (FILM_ID)
);

CREATE TABLE IF NOT EXISTS GENRES
(
    GENRE_ID BIGINT      NOT NULL AUTO_INCREMENT,
    NAME     VARCHAR(50) NOT NULL,
    CONSTRAINT GENRES_PK PRIMARY KEY (GENRE_ID)
);

CREATE TABLE IF NOT EXISTS FILM_GENRES
(
    FILM_ID  BIGINT REFERENCES FILMS (FILM_ID) ON DELETE CASCADE ON UPDATE RESTRICT,
    GENRE_ID BIGINT REFERENCES GENRES (GENRE_ID) ON DELETE RESTRICT ON UPDATE RESTRICT,
    CONSTRAINT FILM_GENRES_PK PRIMARY KEY (FILM_ID, GENRE_ID)
);


CREATE TABLE IF NOT EXISTS LIKES
(
    USER_ID BIGINT REFERENCES USERS (USER_ID) ON DELETE CASCADE ON UPDATE RESTRICT,
    FILM_ID BIGINT REFERENCES FILMS (FILM_ID) ON DELETE CASCADE ON UPDATE RESTRICT,
    MARK    REAL NOT NULL,
    CONSTRAINT LIKES_PK PRIMARY KEY (USER_ID, FILM_ID)
);

CREATE TABLE IF NOT EXISTS REVIEWS
(
    REVIEW_ID   BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CONTENT     VARCHAR(255)                      NOT NULL,
    IS_POSITIVE BOOLEAN,
    USER_ID     BIGINT REFERENCES USERS (USER_ID) NOT NULL,
    FILM_ID     BIGINT REFERENCES FILMS (FILM_ID) NOT NULL
);

CREATE TABLE IF NOT EXISTS REVIEWS_REACTIONS
(
    REVIEW_ID BIGINT REFERENCES REVIEWS (REVIEW_ID) NOT NULL,
    USER_ID   BIGINT REFERENCES USERS (USER_ID)     NOT NULL,
    REACTION  INTEGER,
    PRIMARY KEY (REVIEW_ID, USER_ID)
);

CREATE TABLE IF NOT EXISTS EVENTS (
	EVENT_ID    BIGINT NOT NULL AUTO_INCREMENT,
	USER_ID     BIGINT REFERENCES USERS (USER_ID) ON DELETE CASCADE ON UPDATE RESTRICT,
	CREATED_AT  TIMESTAMP WITH TIME ZONE NOT NULL,
	EVENT_TYPE  VARCHAR(10) CHECK (EVENT_TYPE IN ('LIKE', 'REVIEW', 'FRIEND')),
	OPERATION   VARCHAR(10) CHECK (OPERATION IN ('REMOVE', 'ADD', 'UPDATE')),
	ENTITY_ID   BIGINT NOT NULL,
	CONSTRAINT  FEED_PK PRIMARY KEY (EVENT_ID)
);

-- add-director
CREATE TABLE IF NOT EXISTS DIRECTORS (
	DIRECTOR_ID BIGINT NOT NULL AUTO_INCREMENT,
	DIRECTOR_NAME VARCHAR(255) NOT NULL,
	CONSTRAINT DIRECTORS_PK PRIMARY KEY (DIRECTOR_ID)
);

CREATE TABLE IF NOT EXISTS FILM_DIRECTORS (
	FILM_ID BIGINT REFERENCES FILMS (FILM_ID) ON DELETE CASCADE ON UPDATE RESTRICT,
	DIRECTOR_ID BIGINT REFERENCES DIRECTORS (DIRECTOR_ID) ON DELETE CASCADE ON UPDATE RESTRICT,
	CONSTRAINT FILM_DIRECTORS_PK PRIMARY KEY (FILM_ID, DIRECTOR_ID)
);